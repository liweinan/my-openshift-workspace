# OCP-29781 æµ‹è¯•ç¯å¢ƒè®¾ç½®å®Œæˆ

## ğŸ¯ æµ‹è¯•ç›®æ ‡
åœ¨å…±äº«VPCä¸­åˆ›å»ºä¸¤ä¸ªOpenShifté›†ç¾¤ï¼Œä½¿ç”¨ä¸åŒçš„éš”ç¦»CIDRå—ï¼ŒéªŒè¯ç½‘ç»œéš”ç¦»ã€‚

## âœ… å½“å‰çŠ¶æ€
æ‰€æœ‰å‰ç½®æ¡ä»¶å·²æ»¡è¶³ï¼Œå¯ä»¥å¼€å§‹å®Œæ•´æµ‹è¯•ï¼š

- âœ… **VPCåˆ›å»ºæˆåŠŸ**: `vpc-06230a0fab9777f55`
- âœ… **å­ç½‘æ ‡ç­¾åº”ç”¨æˆåŠŸ**: æ‰€æœ‰6ä¸ªå­ç½‘éƒ½å·²æ­£ç¡®æ ‡è®°
- âœ… **Install-configæ–‡ä»¶é…ç½®æ­£ç¡®**: ä½¿ç”¨æ­£ç¡®çš„å­ç½‘IDå’ŒCIDR
- âœ… **CIDRéš”ç¦»é…ç½®æ­£ç¡®**: é›†ç¾¤1ä½¿ç”¨10.134.0.0/16ï¼Œé›†ç¾¤2ä½¿ç”¨10.190.0.0/16

## ğŸŒ ç½‘ç»œé…ç½®

### VPCä¿¡æ¯
- **VPC ID**: `vpc-06230a0fab9777f55`
- **ä¸»CIDR**: `10.0.0.0/16`
- **ç¬¬äºŒCIDR**: `10.134.0.0/16`
- **ç¬¬ä¸‰CIDR**: `10.190.0.0/16`
- **åŒºåŸŸ**: `us-east-1`

### å­ç½‘åˆ†å¸ƒ
```
CIDR1 (10.0.0.0/16):
  ç§æœ‰: subnet-040352803251c4e29 (us-east-1a, 10.0.16.0/20)
  å…¬å…±: subnet-095a87739ee0aaa1e (us-east-1a, 10.0.32.0/20)

CIDR2 (10.134.0.0/16):
  ç§æœ‰: subnet-05a28363f522028d1 (us-east-1b, 10.134.16.0/20)
  å…¬å…±: subnet-092a3f51f56c64eff (us-east-1b, 10.134.32.0/20)

CIDR3 (10.190.0.0/16):
  ç§æœ‰: subnet-0a98f109612e4dbd6 (us-east-1c, 10.190.16.0/20)
  å…¬å…±: subnet-0de71774eb1265810 (us-east-1c, 10.190.32.0/20)
```

### é›†ç¾¤é…ç½®
**é›†ç¾¤1 (weli-test-a)**:
- Machine CIDR: `10.134.0.0/16`
- ç§æœ‰å­ç½‘: `subnet-05a28363f522028d1`
- å…¬å…±å­ç½‘: `subnet-092a3f51f56c64eff`

**é›†ç¾¤2 (weli-test-b)**:
- Machine CIDR: `10.190.0.0/16`
- ç§æœ‰å­ç½‘: `subnet-0a98f109612e4dbd6`
- å…¬å…±å­ç½‘: `subnet-0de71774eb1265810`

## ğŸš€ å¯ç”¨è„šæœ¬

### 1. å¿«é€ŸéªŒè¯
```bash
./quick-verify.sh
```
éªŒè¯å½“å‰è®¾ç½®çŠ¶æ€ã€‚

### 2. å®Œæ•´æµ‹è¯•æµç¨‹
```bash
./run-ocp29781-test.sh
```
è¿è¡Œå®Œæ•´çš„OCP-29781æµ‹è¯•æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š
- åˆ›å»ºä¸¤ä¸ªOpenShifté›†ç¾¤
- éªŒè¯é›†ç¾¤å¥åº·çŠ¶æ€
- éªŒè¯å®‰å…¨ç»„é…ç½®
- éªŒè¯ç½‘ç»œéš”ç¦»
- åˆ›å»ºbastion host

### 3. æ¸…ç†èµ„æº
```bash
./run-ocp29781-test.sh cleanup
```
æ¸…ç†æ‰€æœ‰åˆ›å»ºçš„èµ„æºã€‚

### 4. VPCåˆ›å»ºï¼ˆå·²ä½¿ç”¨ï¼‰
```bash
./create-vpc.sh -n weli-test-vpc -r us-east-1
```
åˆ›å»ºVPCå’Œå­ç½‘ï¼ˆå·²å®Œæˆï¼‰ã€‚

## ğŸ“‹ æµ‹è¯•æ­¥éª¤

1. **VPCåˆ›å»º** âœ… å·²å®Œæˆ
2. **å­ç½‘æ ‡ç­¾** âœ… å·²å®Œæˆ
3. **Install-configé…ç½®** âœ… å·²å®Œæˆ
4. **é›†ç¾¤åˆ›å»º** - è¿è¡Œ `./run-ocp29781-test.sh`
5. **å¥åº·æ£€æŸ¥** - è‡ªåŠ¨æ‰§è¡Œ
6. **å®‰å…¨ç»„éªŒè¯** - è‡ªåŠ¨æ‰§è¡Œ
7. **ç½‘ç»œéš”ç¦»æµ‹è¯•** - è‡ªåŠ¨æ‰§è¡Œ
8. **Bastion hoståˆ›å»º** - è‡ªåŠ¨æ‰§è¡Œ

## ğŸ”§ ä¿®å¤çš„é—®é¢˜

### åŸå§‹CIå¤±è´¥åŸå› 
```
platform.aws.vpc.subnets: Forbidden: additional subnets [...] without tag prefix kubernetes.io/cluster/ are found in vpc [...]
```

### ä¿®å¤æ–¹æ¡ˆ
1. **VPCæ¨¡æ¿ä¿æŒåŸæ ·** - ä¸åŒ…å«cluster-specificæ ‡ç­¾
2. **ä½¿ç”¨tag-subnets.shè„šæœ¬** - åœ¨VPCåˆ›å»ºåä¸ºå­ç½‘æ‰“æ ‡ç­¾
3. **ä½¿ç”¨create-bastion-host.shè„šæœ¬** - åœ¨public subnetä¸­åˆ›å»ºbastion
4. **æ­£ç¡®çš„install-configæ ¼å¼** - ä½¿ç”¨`platform.aws.vpc.subnets`

## ğŸ“Š é¢„æœŸç»“æœ

æµ‹è¯•å®Œæˆååº”è¯¥éªŒè¯ï¼š
- âœ… ä¸¤ä¸ªé›†ç¾¤åœ¨ä¸åŒCIDRä¸­æˆåŠŸå®‰è£…
- âœ… ç½‘ç»œéš”ç¦»éªŒè¯é€šè¿‡ï¼ˆ100% packet lossï¼‰
- âœ… å®‰å…¨ç»„é…ç½®æ­£ç¡®
- âœ… Bastion hoståœ¨public subnetä¸­åˆ›å»º

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `01_vpc_multiCidr.yaml` - CloudFormationæ¨¡æ¿
- `install-config-cluster1.yaml` - é›†ç¾¤1é…ç½®
- `install-config-cluster2.yaml` - é›†ç¾¤2é…ç½®
- `create-vpc.sh` - VPCåˆ›å»ºè„šæœ¬
- `run-ocp29781-test.sh` - å®Œæ•´æµ‹è¯•è„šæœ¬
- `quick-verify.sh` - å¿«é€ŸéªŒè¯è„šæœ¬
- `CI_FAILURE_ANALYSIS.md` - CIå¤±è´¥åˆ†ææŠ¥å‘Š
- `OCP-29781_TEST_PROCEDURE.md` - è¯¦ç»†æµ‹è¯•æµç¨‹

## ğŸ¯ ä¸‹ä¸€æ­¥

è¿è¡Œå®Œæ•´æµ‹è¯•ï¼š
```bash
./run-ocp29781-test.sh
```

è¿™å°†åˆ›å»ºä¸¤ä¸ªOpenShifté›†ç¾¤å¹¶éªŒè¯æ‰€æœ‰åŠŸèƒ½ã€‚